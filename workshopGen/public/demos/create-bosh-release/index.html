<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.51" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link rel="icon" href="/images/favicon.png" type="image/x-icon" />
    <title> :: Pivotal Workshop</title>

    
    <link href="/css/nucleus.css?1542292529" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1542292529" rel="stylesheet">
    <link href="/css/hybrid.css?1542292529" rel="stylesheet">
    <link href="/css/featherlight.min.css?1542292529" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1542292529" rel="stylesheet">
    <link href="/css/auto-complete.css?1542292529" rel="stylesheet">
    <link href="/css/theme.css?1542292529" rel="stylesheet">
    <link href="/css/hugo-theme.css?1542292529" rel="stylesheet">
    

    <script src="/js/jquery-2.x.min.js?1542292529"></script>

    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/demos/create-bosh-release/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="">
    <svg x="0px" y="0px" width="50%" height="100%" viewBox="0 0 291.93 68.4" xmlns="http://www.w3.org/2000/svg">
        <g class="cls-1">
        <path style="fill:#008775;" d="M131.51,61.59H121.14v-10h10.37v10Zm0,57.21h-10.4V69h10.4V118.8Z" transform="translate(-66.72 -51.56)"></path>
        <path style="fill:#008775;" d="M191.48,69L177,112c-2.49,7-6.92,7.94-10.52,7.94-5.33,0-8.54-2.45-10.44-7.93L144,76.27h-4.77V69h12.45l12.44,40c0.54,1.71.88,2.73,2.39,2.73s1.88-1,2.38-2.73l12.69-40h9.92Z" transform="translate(-66.72 -51.56)"></path>
        <path style="fill:#008775;" d="M217.08,69c13.45,0,22.83,8.87,22.83,21.59v7.83c0,12.7-9.38,21.59-22.83,21.59s-22.84-8.89-22.84-21.59V90.54c0-12.71,9.4-21.59,22.84-21.59m0,42.8c8,0,13-6.08,13-13.38V90.54c0-7.3-4.94-13.39-13-13.39-8.52,0-13,6.08-13,13.39v7.83c0,7.3,4.7,13.38,13,13.38" transform="translate(-66.72 -51.56)"></path>
        <path style="fill:#008775;" d="M322.9,70.55a88.57,88.57,0,0,0-19.25-2.3c-13.65,0-22.12,8.61-22.12,22.48v5.46c0,13.86,8.47,22.6,22.12,22.6,0.32,0,2.74,0,3.85-.1v-8.37c-0.42,0-3.54.11-3.85,0.11-7.42,0-12.42-5.72-12.42-14.24V90.73c0-8.52,5-14.24,12.42-14.24a72.93,72.93,0,0,1,10.18.64l0.56,0.12V118.8h10.39V72.27c0-.89,0-1.23-1.89-1.73" transform="translate(-66.72 -51.56)"></path>
        <rect style="fill:#008775;" height="67.24" width="10.39" x="268.07"></rect>
        <path style="fill:#008775;" d="M85,51.56H66.72v67.23H77.53V60.91h6.34c1.35,0,2.49.07,3.64,0.09,9.37,0.18,14,3.9,14,11.18,0,0.29,0,.49,0,0.79,0,6.74-3.7,11.21-13.92,11.21-1,0-2,0-3,0,0,2.58,0,7.36,0,9,1.05,0.05,2,.09,3.05.09,14.66,0,25-5.76,25-20.23,0-.28,0-0.58,0-0.87,0-15-11.28-20.64-27.61-20.64" transform="translate(-66.72 -51.56)"></path>
        <path style="fill:#008775;" d="M258.37,58.21V69h16.93V77H258.37v29c0,4.56,2.91,4.68,7.13,4.68h9.8v8.06H262c-9.81,0-14.18-3.93-14.18-12.74V59.65Z" transform="translate(-66.72 -51.56)"></path>
        </g>
        <path style="fill:#008775;" d="M350,114.44a4.34,4.34,0,1,1,4.34,4.36A4.36,4.36,0,0,1,350,114.44Zm4.35-3.75a3.73,3.73,0,1,0,3.71,3.73A3.73,3.73,0,0,0,354.31,110.7Zm-1,6.05h-0.5V112h1.33c1.2,0,1.78.55,1.78,1.43a1.39,1.39,0,0,1-1,1.35l1.22,1.95h-0.6l-1.13-1.83-1.13.07v1.76Zm0.85-2.24a1.09,1.09,0,0,0,1.26-1c0-.67-0.42-1-1.33-1h-0.8v2.07Z" transform="translate(-66.72 -51.56)"></path>
    </svg>
    <p>PLATFORM ARCHITECTURE</p>
  </a>
  
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="text" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-close"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1542292529"></script>
<script type="text/javascript" src="/js/auto-complete.js?1542292529"></script>
<script type="text/javascript">
    
        var baseurl = "";
    
</script>
<script type="text/javascript" src="/js/search.js?1542292529"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics" id="yup">

        
          
          


 
  
    
    <li data-nav-id="/workshop/" title="Fiserv/THD OpsMan Deep Dive Workshop" class="dd-item 
        
        
        
        ">
      <a href="/workshop/">
          Fiserv/THD OpsMan Deep Dive Workshop
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/concepts/" title="Concepts" class="dd-item 
        
        
        
        ">
      <a href="/concepts/">
          Concepts
          
      </a>
      
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/demos/" title="Demos" class="dd-item 
        parent
        
        
        ">
      <a href="/demos/">
          Demos
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/demos/bbl-up/" title="" class="dd-item ">
        <a href="/demos/bbl-up/">
        BBL Up
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/deploy-opsman-pipeline/" title="" class="dd-item ">
        <a href="/demos/deploy-opsman-pipeline/">
        Deploy OpsMan
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/create-bosh-release/" title="" class="dd-item active">
        <a href="/demos/create-bosh-release/">
        Create BOSH Release
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/deploy-bosh-release/" title="" class="dd-item ">
        <a href="/demos/deploy-bosh-release/">
        Deploy BOSH Release
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/example-stemcell/" title="" class="dd-item ">
        <a href="/demos/example-stemcell/">
        Example Stemcell
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/init/" title="" class="dd-item ">
        <a href="/demos/init/">
        Service Broker Init
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/demos/catalog/" title="" class="dd-item ">
        <a href="/demos/catalog/">
        Service Broker Catalog
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
        <li>
          <a class="padding">
            <i class="fas fa-language fa-fw"></i>
          <div class="select-style">
            <select id="select-language" onchange="location = this.value;">
          
          
          
              
              
                  
                    
                    
                      <option id="en" value="/demos/create-bosh-release/" selected>English</option>
                    
                  
              
                  
              
                  
              
                  
              
          
        </select>
        <svg version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
          width="255px" height="255px" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255;" xml:space="preserve">
          <g>
            <g id="arrow-drop-down">
              <polygon points="0,63.75 127.5,191.25 255,63.75 		" />
            </g>
          </g>
        </svg>
        </div>
        </a>
        </li>
      
      
      
      </ul>
    </section>
    
    <section id="footer">
      <p>Built with <i class="fas fa-heart"></i></a> by <a href="https://pivotal.io">Pivotal</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Pivotal Workshop</a> > <a href='/demos/'>Demos</a> > 
          
         
          
         
          
           
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#goal">Goal</a></li>
<li><a href="#create-the-bosh-release">Create the BOSH Release</a>
<ul>
<li><a href="#create-source-code">Create Source Code</a></li>
<li><a href="#create-the-job">Create the Job</a></li>
<li><a href="#create-the-package">Create the Package</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            

        
        <div id="body-inner">
          
            <h1></h1>
          

        




<h2 id="goal">Goal</h2>

<p>Deploying software systems with BOSH is done with BOSH Releases. Releases abstract code away from the underlying OS and create a specific packing structure all software systems must adhere to. Lets explore what a BOSH Release is by using a very simple release that prints log messages.</p>

<h2 id="create-the-bosh-release">Create the BOSH Release</h2>

<p>To create the release directory, navigate into the workspace where you want the release to be, and run:
- <code>$ bosh init-release --dir &lt;release_name&gt;</code></p>

<p>If you have <code>tree</code> (Hint: <code>$ brew install tree</code>) you can view the directory structure:</p>

<pre><code>tree .
.
├── config
│   ├── blobs.yml
│   └── final.yml
├── jobs
├── packages
└── src

4 directories, 2 files
</code></pre>

<p>For this deployment we are going to make a very simple app that prints to <code>STDOUT</code>.</p>

<h3 id="create-source-code">Create Source Code</h3>

<p>Inside the src folder make a new dir called sample_app</p>

<pre><code>$ cd src/
$ mkdir sample_app
$ cd sample_app/
</code></pre>

<p>Using your favorite editor, create the <code>app</code>, add the source code for the script.</p>

<pre><code>#!/bin/bash
while true
do
    echo &quot;Sample APP STDOUT!!!&quot;
    sleep 1
done        
</code></pre>

<h3 id="create-the-job">Create the Job</h3>

<p>Navigate back to the release directory create the job skeleton
- <code>$ bosh generate-job sample_job</code></p>

<p>Once again <code>tree</code> will show use the new files and folders generated</p>

<pre><code>tree .
.
├── config
│   ├── blobs.yml
│   └── final.yml
├── jobs
│   └── sample_job
│       ├── monit
│       ├── spec
│       └── templates
├── packages
└── src
   └── sample_app
       └── app

7 directories, 5 files
</code></pre>

<p>A control script is used to tell the job how to start and stop. Navigate to the <code>templates</code> directory and create <code>ctl.erb</code> with an editor</p>

<pre><code>#!/bin/bash

RUN_DIR=/var/vcap/sys/run/sample_job
LOG_DIR=/var/vcap/sys/log/sample_job
PIDFILE=${RUN_DIR}/pid

case $1 in

  start)
    mkdir -p $RUN_DIR $LOG_DIR
    chown -R vcap:vcap $RUN_DIR $LOG_DIR

    echo $$ &gt; $PIDFILE

    cd /var/vcap/packages/sample_app

     exec ./app \
      &gt;&gt;  $LOG_DIR/sample_app.stdout.log \
      2&gt;&gt; $LOG_DIR/sample_app.stderr.log

    ;;

  stop)
    kill -9 `cat $PIDFILE`
    rm -f $PIDFILE

    ;;

  *)
    echo &quot;Usage: ctl {start|stop}&quot; ;;

esac
</code></pre>

<p>In order for BOSH to monitor the health of our running job it utilizes  <a href="https://en.wikipedia.org/wiki/Monit">monit</a>.</p>

<p>To configure monit for our process we create a monit file that explains what processid corresponds to our application we are asking to be monitored and how to start/stop the application.</p>

<pre><code>check process sample_app
  with pidfile /var/vcap/sys/run/sample_job/pid
  start program &quot;/var/vcap/jobs/sample_job/bin/ctl start&quot;
  stop program &quot;/var/vcap/jobs/sample_job/bin/ctl stop&quot;
  group vcap
</code></pre>

<p>BOSH requires a monit file for each job in a release. When developing a release, you can use an empty monit file to meet this requirement without having to first create a control script.</p>

<p>At compile time, BOSH transforms templates into files, which it then replicates on the job VMs. The template names and file paths are among the metadata for each job that resides in the job spec file.</p>

<p>Edit the <code>spec</code> file:</p>

<pre><code>---
name: sample_job

templates:
  ctl.erb: bin/ctl

packages:
- sample_app

properties: {}
</code></pre>

<p>Our <code>sample_job</code> has a dependency on the <code>sample_app</code> so we will create the package to encapsulate that in the next section.</p>

<h3 id="create-the-package">Create the Package</h3>

<p>Once again we navigate back to the release directory and run the generate command</p>

<pre><code>$ bosh generate-package sample_app
</code></pre>

<p>And tree</p>

<pre><code>tree .
.
├── config
│   ├── blobs.yml
│   └── final.yml
├── jobs
│   └── sample_job
│       ├── monit
│       ├── spec
│       └── templates
│           └── ctl.erb
├── packages
│   └── sample_app
│       ├── packaging
│       └── spec
└── src
└── sample_app
    └── app

8 directories, 8 files
</code></pre>

<p>Let&rsquo;s update the spec, since our app only uses it&rsquo;s source code, we can use the globbing pattern <code>&lt;package_name&gt;/**/*</code> to deep-traverse the directory in <code>src</code> where the source code should reside.</p>

<pre><code>---
name: sample_app

dependencies: []

files:
- sample_app/**/*
</code></pre>

<p>Since this release only has a bash script which does not require compilation we will just copy the script into the compiled code location allow us to use later.</p>

<pre><code>set -e -x

cp -a sample_app/* ${BOSH_INSTALL_TARGET}
</code></pre>

<p>We have all the pieces of our bosh release. We just need to use bosh to create and upload the release. We need to use &ndash;force because by default BOSH requires a blob to already exist. We don&rsquo;t need a blob for our sample_app.
- <code>$ bosh create-release --force</code></p>

<pre><code>       Adding package 'sample_app/e48b68edccfc35fc9bbd1fe37b652fd3bb261cb9'...
       Adding job 'sample_job/5765370e9d13c6c9d8a2db5631251e74fed718e9'...
       Added package 'sample_app/e48b68edccfc35fc9bbd1fe37b652fd3bb261cb9'
       Added job 'sample_job/5765370e9d13c6c9d8a2db5631251e74fed718e9'

       Added dev release 'bosh-release/0+dev.1'

       Name         bosh-release  
       Version      0+dev.1  
       Commit Hash  non-git  

       Job                                                  Digest                                    Packages  
       sample_job/5765370e9d13c6c9d8a2db5631251e74fed718e9  98c11bd46321008ed0802a75f5d26d3d05addb62  sample_app  

       1 jobs

       Package                                              Digest                                    Dependencies  
       sample_app/e48b68edccfc35fc9bbd1fe37b652fd3bb261cb9  e32a56fd1fb3fa819d18eda5f4342d7fac2c3cf0  -  

       1 packages

       Succeeded
</code></pre>

<ul>
<li><p><code>$ bosh upload-release</code></p>

<pre><code>  Using environment 'https://10.0.0.6:25555' as client 'admin'

  ########################################################## 100.00% 2.08 KiB/s 0s
  Task 21

  Task 21 | 00:17:50 | Extracting release: Extracting release (00:00:00)
  Task 21 | 00:17:50 | Verifying manifest: Verifying manifest (00:00:00)
  Task 21 | 00:17:50 | Resolving package dependencies: Resolving package dependencies (00:00:00)
  Task 21 | 00:17:50 | Creating new packages: sample_app/e48b68edccfc35fc9bbd1fe37b652fd3bb261cb9 (00:00:00)
  Task 21 | 00:17:50 | Creating new jobs: sample_job/5765370e9d13c6c9d8a2db5631251e74fed718e9 (00:00:00)
  Task 21 | 00:17:50 | Release has been created: bosh-release/0+dev.1 (00:00:00)

  Task 21 Started  Thu Nov 15 00:17:50 UTC 2018
  Task 21 Finished Thu Nov 15 00:17:50 UTC 2018
  Task 21 Duration 00:00:00
  Task 21 done

  Succeeded
</code></pre></li>

<li><p><code>$ bosh releases</code></p>

<pre><code>  Using environment 'https://10.0.0.6:25555' as client 'admin'

  Name          Version  Commit Hash  
  bosh-dns      1.10.0*  7c6515f  
  bosh-release  0+dev.1  non-git  
  gogs          5.4.0*   ca84293  

  (*) Currently deployed
  (+) Uncommitted changes

  3 releases

  Succeeded
</code></pre></li>
</ul>

<p>That&rsquo;s it! You have now seen all the parts of a full BOSH release! Now that we have our release, we need to create a manifest to deploy it.</p>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


        
            <a class="nav nav-prev" href="/demos/deploy-opsman-pipeline/" title=""> <i class="fas fa-chevron-left"></i></a>
        
        
            <a class="nav nav-next" href="/demos/deploy-bosh-release/" title="" style="margin-right: 0px;"><i class="fas fa-chevron-right"></i></a>
        
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1542292529"></script>
    <script src="/js/perfect-scrollbar.min.js?1542292529"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1542292529"></script>
    <script src="/js/jquery.sticky.js?1542292529"></script>
    <script src="/js/featherlight.min.js?1542292529"></script>
    <script src="/js/html5shiv-printshiv.min.js?1542292529"></script>
    <script src="/js/highlight.pack.js?1542292529"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom.71422.js?1542292529"></script>
    <script src="/js/learn.js?1542292529"></script>
    <script src="/js/hugo-learn.js?1542292529"></script>

    <link href="/mermaid/mermaid.css?1542292529" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1542292529"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

